<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:sec="http://thymeleaf.org/extras.spring-security">

    <head th:replace="~{layout/plantilla :: head}">
        <title>Punto de Venta</title>
    </head>
    <body>
        <header th:replace="~{layout/plantilla :: header}"/>
        <div class="container">
            <div class="row">
                <!-- Columna del formulario Punto de Venta (Modificado) -->
                <div class="col-md-4">
                    <h2 class="mb-4">Punto de Venta</h2>

                    <!-- Formulario de Registro de Productos (Modificado) -->
                    <form>            
                        <div class='form-group'>
                            <label for="producto">Producto</label>
                            <div>
                                <!-- Input de tipo texto con autocompletado -->
                                <input type="text" id="productoInput" name="producto.productoInput" placeholder="Nombre del Producto" oninput="mostrarSugerencias()" list="productos">

                                <!-- Datalist para asociar con el input -->
                                <datalist id="productos">
                                    <option th:each="producto : ${productos}" th:value="${producto.nombre}" th:text="${producto.nombre}"></option>
                                </datalist>
                                
                                <!--<p th:each="producto : ${productos}" th:value="${producto.precio}" th:text="${producto.precio}"></p>-->
                            </div>
                        </div>        
                        
                        <div class="mb-3">
                            <label for="cantidad" class="form-label">Cantidad</label>
                            <input
                                type="number"
                                class="form-control"
                                id="cantidad"
                                placeholder="Cantidad"
                                required
                                />
                        </div>
                        <div class="mb-3">
                            <label for="precio" class="form-label">Precio</label>
                            <input
                                type="number"
                                class="form-control"
                                id="precio"
                                placeholder="Precio"
                                />
                        </div>
                        
                        <button
                            type="button"
                            class="btn btn-primary"
                            onclick="agregarAlCarrito()"
                            >
                            Agregar al Carrito
                        </button>
                    </form>
                </div>

                <!-- Columna de Búsqueda de Productos (Modificado) -->
                <div class="col-md-4">
                    <h2 class="mb-4">Buscar Productos</h2>

                    <!-- Campo de Búsqueda y Resultados (Añadido) -->
                    <div class="mb-3">
                        <label for="buscarProducto" class="form-label">Buscar Producto</label>
                        <input
                            type="text"
                            class="form-control"
                            id="buscarProducto"
                            placeholder="Nombre del Producto"
                            oninput="buscarProductos()"
                            />
                    </div>
                    <textarea id="resultadosBusqueda" class="form-control" rows="5" readonly></textarea>
                </div>

                <!-- Columna del Carrito -->
                <div class="col-md-4">
                    <div class="mt-5">
                        <h4>Carrito</h4>
                        <ul class="list-group" id="carrito">
                            <!-- Los elementos del carrito se agregarán aquí dinámicamente -->
                        </ul>
                        <hr />
                        <div class="mb-3">
                            <label for="total" class="form-label">Total</label>
                            <input
                                type="text"
                                class="form-control"
                                id="total"
                                value="$0.00"
                                readonly
                                />
                        </div>
                        <div class="mb-3">
                            <label for="descuento" class="form-label">Descuento</label>
                            <input
                                type="number"
                                class="form-control"
                                id="descuento"
                                placeholder="Descuento"
                                value="0"
                                />
                        </div>
                        <button
                            type="button"
                            class="btn btn-success"
                            onclick="procesarVenta()"
                            >
                            Procesar Venta
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <footer th:replace="~{layout/plantilla :: footer}"/>

        <script>
            // Función para buscar productos (Añadida)
            
                        function mostrarSugerencias() {
                            var input = document.getElementById("productoInput");
                            var select = document.getElementById("producto");
                            var sugerencias = document.getElementById("sugerencias");

                            // Limpiar la lista de sugerencias
                            sugerencias.innerHTML = "";

                            // Obtener el valor actual del input
                            var valorInput = input.value.toLowerCase();

                            // Filtrar las categorías que coinciden con el valor del input
                            var productos = Array.from(select.options).filter(function(opcion) {
                                return opcion.text.toLowerCase().includes(valorInput);
                            });

                            // Mostrar las sugerencias
                            productos.forEach(function(opcion) {
                                var sugerencia = document.createElement("li");
                                sugerencia.textContent = opcion.text;
                                sugerencias.appendChild(sugerencia);
                            });
                        }

            // Función para agregar al carrito (Añadida)
            function agregarAlCarrito() {
                // Aquí puedes implementar la lógica para agregar elementos al carrito.
                // Puedes obtener los valores de los campos (nombre, cantidad, precio) y actualizar la lista de carrito.
                // También puedes actualizar el total y cualquier otra lógica relacionada con la venta.
            }

            // Función para procesar la venta (Añadida)
            function procesarVenta() {
                // Aquí puedes implementar la lógica para procesar la venta.
                // Puedes calcular el total, aplicar descuentos, realizar operaciones necesarias, etc.
            }
        </script>
    </body>
</html>